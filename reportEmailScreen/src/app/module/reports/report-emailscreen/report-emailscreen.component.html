<div class="bgContainer">
  <mat-card>
    <h2 class="colorDarkGreen heading">Data Reports</h2>
    <form createNewEmail="ngForm">
      <mat-form-field appearance="standard" class="mat-form-Field">
        <mat-label>Filter</mat-label>
        <input
          matInput
          (keyup)="applyFilter($event)"
          placeholder="Search here"
          [(ngModel)]="search"
          name="search"
          #input
         
        />
      </mat-form-field>

      <table mat-table [dataSource]="reportData" class="mat-elevation-z0">
        <!-- No Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>No.</th>
          <td mat-cell *matCellDef="let report">{{ report.id }}</td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Name</th>
          <td mat-cell *matCellDef="let report">{{ report.name}}</td>
        </ng-container>

        <!--Emails Column -->
        <ng-container matColumnDef="emails">
          <th mat-header-cell *matHeaderCellDef>Recipients Emails</th>
          <td mat-cell *matCellDef="let report; let reportIndex = index">
            <mat-form-field class="form-field"
              [appearance]="editableRow.id != report.id ? 'none' : 'standard'"
            >
              <mat-chip-list #chipList aria-label="Email selection">
                <!-- for Existing -->
                <mat-chip
                  *ngFor="
                    let email of report.recipientsEmail.existing;
                    let emailIndex = index
                  "
                  (removed)="removeEmail(emailIndex,email, report)"
                >
                  {{ email }} 
                  <mat-icon
                    matTooltip="Remove"
                    matChipRemove
                    *ngIf="editableRow.id === report.id"
                    >cancel</mat-icon
                  >
                </mat-chip>
                <!-- for Inserted -->
                <mat-chip
                  selected
                  color="primary"
                  *ngFor="
                    let email of report.recipientsEmail.inserted;
                    let emailIndex = index
                  "
                  (removed)="removeEmail(emailIndex, email, report)"
                >
                  {{ email }}
                  <mat-icon
                    matTooltip="Remove"
                    matChipRemove
                    *ngIf="editableRow.id === report.id"
                    >cancel</mat-icon
                  >
                </mat-chip>

                <input
                  matInput
                  [matChipInputFor]="chipList"
                  [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                  [matChipInputAddOnBlur]="addOnBlur"
                  (matChipInputTokenEnd)="addNewEmail($event, report.id,emailIndex)"
                  [readonly]="editableRow.id != report.id"
                />
              </mat-chip-list>
            </mat-form-field>
            <!-- delete Recipients Emails chips -->
            <mat-chip-list>
              <mat-chip
                selected
                color="warn"
                *ngFor="
                  let email of report.recipientsEmail.deleted;
                  let deletedemailIndex = index
                "
              >
                {{ email }}
              </mat-chip>
            </mat-chip-list>
          </td>
        </ng-container>

        <!--Frequency Column-->
        <ng-container matColumnDef="frequency">
          <th mat-header-cell *matHeaderCellDef>Frequency</th>
          <td mat-cell *matCellDef="let report">
            {{ report.frequency}}
          </td>
        </ng-container>

        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef>Action</th>
          <td mat-cell *matCellDef="let report">
            <!-- <button *ngIf="isEditable || selectedReportId != report.id" -->
            <button
              *ngIf="!editableRow.isEditable || editableRow.id != report.id"
              mat-icon-button
              matTooltip="Edit"
              color="primary"
              class="material-icons app-toolbar-menu save-button"
              (click)="onEditEmail(report.id, true)"
            >
              <mat-icon>edit</mat-icon>
            </button>
            <button
              *ngIf="editableRow.isEditable && editableRow.id === report.id"
              mat-icon-button
              color="primary"
              type="button"
              color="primary"
              matTooltip="Save"
              class="material-icons app-toolbar-menu save-button btn"
              (click)="postReportData(report.id)"
            >
              <mat-icon>check_circle</mat-icon>
            </button>
            <button
              *ngIf="editableRow.isEditable && editableRow.id === report.id"
              mat-icon-button
              color="primary"
              type="button"
              color="primary"
              class="material-icons app-toolbar-menu save-button btn"
              (click)="cancelEdit(report.id)"
              [disabled]="isVisible"
              matTooltip="Cancel"
            >
              <mat-icon>cancel</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" ></tr>
        <tr mat-row *matRowDef="let report ; columns: displayedColumns"></tr>

        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">
            No data matching the filter "{{ input.value }}"
          </td>
        </tr>
      </table>
      <mat-card
        *ngIf="isLoading"
        style="display: flex; justify-content: center; align-items: center"
      >
        <mat-spinner color="primary"> </mat-spinner>
      </mat-card>
    </form>
  </mat-card>
</div>
